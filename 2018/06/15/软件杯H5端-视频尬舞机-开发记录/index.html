<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="软件杯H5端'视频尬舞机'开发记录"><meta name="keywords" content="Javascript"><meta name="author" content="AddOneG,undefined"><meta name="copyright" content="AddOneG"><title>软件杯H5端'视频尬舞机'开发记录 | AddOneG</title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css?version=1.5.3"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  localSearch: undefined
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#背景"><span class="toc-number">1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#开始"><span class="toc-number">2.</span> <span class="toc-text">开始</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#基本结构"><span class="toc-number">2.1.</span> <span class="toc-text">基本结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WebRTC"><span class="toc-number">2.2.</span> <span class="toc-text">WebRTC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#视频暂停"><span class="toc-number">2.3.</span> <span class="toc-text">视频暂停</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#图片下落"><span class="toc-number">2.4.</span> <span class="toc-text">图片下落</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#定时器封装"><span class="toc-number">2.4.1.</span> <span class="toc-text">定时器封装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#外部延时器"><span class="toc-number">2.4.1.1.</span> <span class="toc-text">外部延时器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#内部定时器"><span class="toc-number">2.4.1.2.</span> <span class="toc-text">内部定时器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#下落处理"><span class="toc-number">2.4.2.</span> <span class="toc-text">下落处理</span></a></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="http://p5sf6v0wz.bkt.clouddn.com/avatar.jpg"></div><div class="author-info__name text-center">AddOneG</div><div class="author-info__description text-center">心似双丝网，中有千千结</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">48</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">31</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">21</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">友情链接</div><a class="author-info-links__name text-center" href="https://blog.triplez.cn/" target="_blank">TripleZ</a><a class="author-info-links__name text-center" href="http://karlrixon.link/" target="_blank">karlrixon</a><a class="author-info-links__name text-center" href="http://qrzbing.cn/" target="_blank">a-Lie-Z</a><a class="author-info-links__name text-center" href="https://primykq.top/" target="_blank">Primykq</a><a class="author-info-links__name text-center" href="https://blog.zeddyu.info/" target="_blank">Zedd</a><a class="author-info-links__name text-center" href="https://yuwenjie.cc/" target="_blank">Seiry</a><a class="author-info-links__name text-center" href="https://mountainlovers.github.io/" target="_blank">Mountain_lovers</a><a class="author-info-links__name text-center" href="https://blog.rexskz.info/" target="_blank">Rex</a></div></div></div><div id="content-outer"><div class="plain" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">AddOneG</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">主页</a><a class="site-page" href="/archives">时间轴</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a></span></div></div><div class="layout" id="content-inner"><article id="post"><div class="plain" id="post-title">软件杯H5端'视频尬舞机'开发记录</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-06-15</time><span class="post-meta__separator">|</span><i class="fa fa-inbox" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Javascript/"> Javascript</a><span class="post-meta__separator">|</span><span class="post-meta-wordcount"><span>Word count: </span><span class="word-count">1,147</span><span class="post-meta__separator">|</span><span>Reading time: 5 min</span></span></div><div id="post-content"><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>自己还没接触过这方面的开发，所以准备写一篇博客长期跟踪这个项目了</p>
<p><strong>技术栈:</strong>   原生<code>Javascript</code>，<code>WebRTC</code></p>
<h1 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h1><h2 id="基本结构"><a href="#基本结构" class="headerlink" title="基本结构"></a>基本结构</h2><p>这里使用<code>Parcel</code>进行搭建</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">src</span><br><span class="line">  --css</span><br><span class="line">  	--index.css</span><br><span class="line">  --js</span><br><span class="line">  	--index.js</span><br><span class="line">  --img</span><br><span class="line">index.html</span><br><span class="line">package.json</span><br></pre></td></tr></table></figure>
<p>在<code>index.html</code>中引入<code>Js</code>和<code>Css</code>然后执行<code>parcel index.html</code>即可运行项目</p>
<h2 id="WebRTC"><a href="#WebRTC" class="headerlink" title="WebRTC"></a>WebRTC</h2><p>基于浏览器的安全策略，通过<code>WebRTC</code>（具体为<code>getUserMedia</code>）调用摄像头和麦克风获取音视频数据，只能是在<code>HTTPS</code>下的网页，或者是本地<code>localhost</code>下才能调用，需要先校验</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> isAllowed = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.onload = validate()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">validate</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> isSecureOrigin = location.protocol === <span class="string">'https:'</span> ||</span><br><span class="line">          location.hostname === <span class="string">'localhost'</span>;</span><br><span class="line">  <span class="keyword">if</span> (!isSecureOrigin) &#123;</span><br><span class="line">      alert(<span class="string">'getUserMedia() must be run from a secure origin: HTTPS or localhost.'</span>);</span><br><span class="line">      isAllowed = <span class="literal">false</span>; <span class="comment">// 判断是否满足条件</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后调用相应的接口打开摄像头，进行链式调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(isAllowed)&#123;</span><br><span class="line">  navigator.mediaDevices.getUserMedia(constraints)</span><br><span class="line">    .then(handleSuccess)</span><br><span class="line">    .catch(handleError);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>constraints</code>为打开的<code>video</code>窗口配置，<code>max</code>，<code>min</code>为最大最小分辨率，<code>ideal</code>为你期望的最佳分辨率，这里目前先简单的做一下适配</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> constraints = &#123;</span><br><span class="line">  audio: <span class="literal">false</span>,  <span class="comment">// 关闭声音</span></span><br><span class="line">  video: &#123;</span><br><span class="line">    width: &#123; <span class="attr">min</span>: <span class="number">350</span>, <span class="attr">ideal</span>: <span class="built_in">window</span>.screen.width + <span class="number">200</span>, <span class="attr">max</span>: <span class="number">800</span> &#125;,</span><br><span class="line">    height: &#123; <span class="attr">min</span>: <span class="number">500</span>, <span class="attr">ideal</span>: <span class="built_in">window</span>.screen.height - <span class="number">200</span>, <span class="attr">max</span>: <span class="number">1500</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>调用失败的函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleError</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'navigator.getUserMedia error: '</span>, error);</span><br><span class="line">  alert(<span class="string">'navigator.getUserMedia error: '</span>, error);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用成功的函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleSuccess</span>(<span class="params">stream</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">window</span>.stream = stream;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//显示在页面上</span></span><br><span class="line">  <span class="keyword">var</span> recordedVideo = <span class="built_in">document</span>.querySelector(<span class="string">'video#recorded'</span>);</span><br><span class="line">  recordedVideo.srcObject = stream;</span><br><span class="line">  recordedVideo.onloadedmetadata = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"Label: "</span> + stream.label);</span><br><span class="line">      <span class="comment">//视频图像</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"VideoTracks"</span> , stream.getVideoTracks());</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  videoPause(recordedVideo) <span class="comment">// 注册暂停播放事件</span></span><br><span class="line">  imgFall() <span class="comment">// 显示下落的图片</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再修改一下<code>Html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Index<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"./src/css/index.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">video</span> <span class="attr">id</span>=<span class="string">'recorded'</span> <span class="attr">class</span>=<span class="string">'recorded'</span> <span class="attr">autoplay</span>&gt;</span></span><br><span class="line">    您的环境不支持播放视频。</span><br><span class="line">  <span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'./src/js/index.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>做到这，不用管之前下面那两个函数，你已经能看到窗口里的你了hhhhh</p>
</blockquote>
<h2 id="视频暂停"><a href="#视频暂停" class="headerlink" title="视频暂停"></a>视频暂停</h2><p><code>video</code>是绝对定位并且浮在最下面的，所以一些点击事件操作通过<code>mask</code>处理</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mask = <span class="built_in">document</span>.getElementById(<span class="string">'mask'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">videoPause</span>(<span class="params">recordedVideo</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  mask.addEventListener(<span class="string">'click'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span>(!recordedVideo.paused)&#123;</span><br><span class="line">      isPause = <span class="literal">true</span></span><br><span class="line">      recordedVideo.pause()</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      isPause = <span class="literal">false</span></span><br><span class="line">      recordedVideo.play()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="图片下落"><a href="#图片下落" class="headerlink" title="图片下落"></a>图片下落</h2><p>这里目前只有一个图片来源，在图片<code>onload</code>回调里进行图片处理，这里封装了一个定时器来循环产生下落的图片</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> track = []</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">imgFall</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> img = <span class="keyword">new</span> Image()</span><br><span class="line">  img.onload = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      </span><br><span class="line">    track[<span class="number">0</span>] = outInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> item = <span class="keyword">new</span> Image()</span><br><span class="line">      item.src = img.src</span><br><span class="line">      item.style.left = <span class="built_in">parseInt</span>((<span class="built_in">window</span>.screen.width - <span class="number">100</span>) * <span class="built_in">Math</span>.random()) + <span class="string">'px'</span></span><br><span class="line">  </span><br><span class="line">      mask.appendChild(item)</span><br><span class="line"></span><br><span class="line">    &#125;, <span class="number">0</span>, <span class="number">5000</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  img.src = <span class="built_in">require</span>(<span class="string">'../img/people.png'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="定时器封装"><a href="#定时器封装" class="headerlink" title="定时器封装"></a>定时器封装</h3><h4 id="外部延时器"><a href="#外部延时器" class="headerlink" title="外部延时器"></a>外部延时器</h4><p>接受3个参数:</p>
<ul>
<li><strong>callback:</strong> 回调函数</li>
<li><strong>begin:</strong> 开始时间</li>
<li><strong>delay:</strong> 定时间隔</li>
</ul>
<p>用一个延时器来延时内部的定时器(<strong>innerInterval</strong>)，然后返回内部定时器</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">outTimeout</span>(<span class="params">callback, begin, delay</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> timeout</span><br><span class="line"></span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    callback()</span><br><span class="line"></span><br><span class="line">    timeout = innerInterval(callback, delay)</span><br><span class="line"></span><br><span class="line">  &#125;, begin)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> timeout;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="内部定时器"><a href="#内部定时器" class="headerlink" title="内部定时器"></a>内部定时器</h4><p>接受2个参数:</p>
<ul>
<li><p><strong>callback:</strong> 回调函数</p>
</li>
<li><p><strong>delay:</strong> 定时间隔</p>
</li>
</ul>
<p>内部进行递归的<code>setTimeout</code>来实现定时器功能，避免了<code>setInterval</code>的间隔重叠问题，保证每个<code>callback</code>经过相同的时间后执行</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">innerInterval</span>(<span class="params">callback, delay</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> timeout = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!isPause) callback() <span class="comment">// 播放状态下才执行回调函数(图片下落)</span></span><br><span class="line">    </span><br><span class="line">    setTimeout(innerInterval(callback, delay), delay)</span><br><span class="line"></span><br><span class="line">  &#125;, delay)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> timeout;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="下落处理"><a href="#下落处理" class="headerlink" title="下落处理"></a>下落处理</h3><p>此处为<code>callback</code>函数中的内容，每次执行的时候创建新的<code>img</code>然后随机<code>left</code>偏移，之后<code>append</code>到父元素中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> item = <span class="keyword">new</span> Image()</span><br><span class="line">item.src = img.src</span><br><span class="line">item.style.left = <span class="built_in">parseInt</span>((<span class="built_in">window</span>.screen.width - <span class="number">100</span>) * <span class="built_in">Math</span>.random()) + <span class="string">'px'</span></span><br><span class="line"></span><br><span class="line">mask.appendChild(item)</span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.mask</span> <span class="selector-tag">img</span>&#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">120px</span>;</span><br><span class="line">  <span class="attribute">animation</span>: fall <span class="number">5s</span> linear forwards;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">keyframes</span> fall &#123;</span><br><span class="line">  <span class="selector-tag">from</span> &#123;</span><br><span class="line">    top: -120px; // 减去图片高度</span><br><span class="line">  &#125; <span class="selector-tag">to</span> &#123;</span><br><span class="line">    top: 100vh; // 落到屏幕下方</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  90% &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  100% &#123;</span><br><span class="line">    opacity: 0; // 变透明</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下落后要定时清除图片元素避免过多，设置清除为第一次下落后执行，间隔为每一次下落完成的时间</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> deleteImg = outTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(mask.childNodes.length &gt; <span class="number">3</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> child = mask.childNodes</span><br><span class="line">        mask.removeChild(child[<span class="number">0</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="number">5000</span>, <span class="number">5000</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果你想要多列图片下落只需要添加<code>track</code>以及相应的延时和删除即可</p>
</blockquote>
<p>目前的样式</p>
<p><img src="http://p5sf6v0wz.bkt.clouddn.com/rjb-imgfall.png" width="400" height="600"></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">AddOneG</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2018/06/15/软件杯H5端-视频尬舞机-开发记录/">http://yoursite.com/2018/06/15/软件杯H5端-视频尬舞机-开发记录/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Javascript/">Javascript</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2018/06/24/Javascript引擎之属性访问优化/"><i class="fa fa-chevron-left">  </i><span>Javascript引擎之属性访问优化</span></a></div><div class="next-post pull-right"><a href="/2018/06/08/关于页面切换后setInterval出现延时问题/"><span>关于页面切换后setInterval出现延时问题</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2018 By AddOneG</div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.5.3"></script><script src="/js/fancybox.js?version=1.5.3"></script><script src="/js/sidebar.js?version=1.5.3"></script><script src="/js/copy.js?version=1.5.3"></script><script src="/js/fireworks.js?version=1.5.3"></script><script src="/js/transition.js?version=1.5.3"></script><script src="/js/scroll.js?version=1.5.3"></script><script src="/js/head.js?version=1.5.3"></script></body></html>