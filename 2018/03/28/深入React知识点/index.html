<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="深入React知识点"><meta name="keywords" content="前端,React,React-Native"><meta name="author" content="AddOneG,undefined"><meta name="copyright" content="AddOneG"><title>深入React知识点 | AddOneG</title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css?version=1.5.3"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  localSearch: undefined
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#背景"><span class="toc-number">1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#开始"><span class="toc-number">2.</span> <span class="toc-text">开始</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ReactNative相比于原生App的优势和劣势"><span class="toc-number">2.1.</span> <span class="toc-text">ReactNative相比于原生App的优势和劣势</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#React的生命周期"><span class="toc-number">2.2.</span> <span class="toc-text">React的生命周期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#关于setState"><span class="toc-number">2.3.</span> <span class="toc-text">关于setState</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#关于state-状态-和props-属性"><span class="toc-number">2.4.</span> <span class="toc-text">关于state(状态)和props(属性)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#state"><span class="toc-number">2.4.1.</span> <span class="toc-text">state</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#props"><span class="toc-number">2.4.2.</span> <span class="toc-text">props</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ref"><span class="toc-number">2.5.</span> <span class="toc-text">Ref</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Context"><span class="toc-number">2.6.</span> <span class="toc-text">Context</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#React事件"><span class="toc-number">2.7.</span> <span class="toc-text">React事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#高阶组件-HOC"><span class="toc-number">2.8.</span> <span class="toc-text">高阶组件(HOC)</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="http://p5sf6v0wz.bkt.clouddn.com/avatar.jpg"></div><div class="author-info__name text-center">AddOneG</div><div class="author-info__description text-center">心似双丝网，中有千千结</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">45</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">31</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">21</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">友情链接</div><a class="author-info-links__name text-center" href="https://blog.triplez.cn/" target="_blank">TripleZ</a><a class="author-info-links__name text-center" href="http://karlrixon.link/" target="_blank">karlrixon</a><a class="author-info-links__name text-center" href="http://qrzbing.cn/" target="_blank">a-Lie-Z</a><a class="author-info-links__name text-center" href="https://primykq.top/" target="_blank">Primykq</a><a class="author-info-links__name text-center" href="https://blog.zeddyu.info/" target="_blank">Zedd</a><a class="author-info-links__name text-center" href="https://yuwenjie.cc/" target="_blank">Seiry</a><a class="author-info-links__name text-center" href="https://mountainlovers.github.io/" target="_blank">Mountain_lovers</a><a class="author-info-links__name text-center" href="https://blog.rexskz.info/" target="_blank">Rex</a></div></div></div><div id="content-outer"><div class="plain" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">AddOneG</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">主页</a><a class="site-page" href="/archives">时间轴</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a></span></div></div><div class="layout" id="content-inner"><article id="post"><div class="plain" id="post-title">深入React知识点</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-03-28</time><span class="post-meta__separator">|</span><i class="fa fa-inbox" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/React/"> React</a><span class="post-meta__separator">|</span><span class="post-meta-wordcount"><span>Word count: </span><span class="word-count">1,460</span><span class="post-meta__separator">|</span><span>Reading time: 5 min</span></span></div><div id="post-content"><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>自己对React方面还没有一个系统的整理，并且自己ReactNative方面比较薄弱，毕竟平时很少用ReactNative进行开发，接触的相关项目也比较少，所以在这里对React的一些知识点进行一些总结，顺便提一下ReactNative方面的知识</p>
<h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><p>以下内容基本为个人理解，如有错误欢迎指出</p>
<h3 id="ReactNative相比于原生App的优势和劣势"><a href="#ReactNative相比于原生App的优势和劣势" class="headerlink" title="ReactNative相比于原生App的优势和劣势"></a>ReactNative相比于原生App的优势和劣势</h3><p><strong>优势</strong></p>
<ul>
<li>节省编译时间，开发效率快</li>
<li>学习成本极低(对于我)</li>
<li>组件化</li>
<li>热更新</li>
</ul>
<p><strong>劣势</strong></p>
<ul>
<li>不太稳定</li>
<li>内存占用较高</li>
</ul>
<h3 id="React的生命周期"><a href="#React的生命周期" class="headerlink" title="React的生命周期"></a>React的生命周期</h3><p>详情可以看我写的这篇<a href="https://addonedn.github.io/2018/03/16/React%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%AE%80%E6%98%8E%E5%AE%9D%E5%85%B8/" target="_blank" rel="noopener">React生命周期简明宝典</a></p>
<h3 id="关于setState"><a href="#关于setState" class="headerlink" title="关于setState"></a>关于setState</h3><blockquote>
<p>setState() schedules an update to a component’s state object. When state changes, the component responds by re-rendering</p>
</blockquote>
<p>一个简化的setState调用图<br><img src="http://p5sf6v0wz.bkt.clouddn.com/setState.png" alt="setState"></p>
<blockquote>
<p>首先，setState是异步执行的</p>
</blockquote>
<blockquote>
<p>setState() does not always immediately update the component. It may batch or defer the update until later. This makes reading this.state right after calling setState() a potential pitfall. Instead, use componentDidUpdate or a setState callback (setState(updater, callback)), either of which are guaranteed to fire after the update has been applied. If you need to set the state based on the previous state, read about the updater argument below.setState() does not always immediately update the component. It may batch or defer the update until later. This makes reading this.state right after calling setState() a potential pitfall. Instead, use componentDidUpdate or a setState callback (setState(updater, callback)), either of which are guaranteed to fire after the update has been applied. If you need to set the state based on the previous state, read about the updater argument below.</p>
</blockquote>
<p>这里意思大概就是setState并不总是立即生效..可能会有延迟，但是你可以用componentDidUpdate或者回调函数来解决这个问题</p>
<p>至于setState为什么是异步的，深入的话涉及到React的事务机制，比较高级，本人能力有限这里就不误人子弟了，有兴趣的同学可以去自学一波</p>
<p>如果你写代码的时候发现你set的data并没有立即生效，那么它们很可能被batch update了</p>
<blockquote>
<p>setState并不负责更新数据，它只是把state和callback放入_pendingStateQueue和_pendingCallback中，并且把要更新的组件放入dirtyComponents序列</p>
</blockquote>
<p>再来个详细一点的图<br><img src="http://p5sf6v0wz.bkt.clouddn.com/setStateX.png" alt="setStateX"></p>
<p>本人目前只能理解到这里了…这个知识点就先到这了</p>
<h3 id="关于state-状态-和props-属性"><a href="#关于state-状态-和props-属性" class="headerlink" title="关于state(状态)和props(属性)"></a>关于state(状态)和props(属性)</h3><h4 id="state"><a href="#state" class="headerlink" title="state"></a>state</h4><p>React 把组件看成是一个状态机（State Machines）。通过与用户的交互，实现不同状态，然后渲染 UI，让用户界面和数据保持一致，在React里只需要更新state，然后根据新的state进行渲染。state 的主要作用是用于组件保存、控制、修改自己的可变状态，是一个局部的、只能被组件自身控制的数据源</p>
<ul>
<li>初始值来源于getInitalState（constructor)</li>
<li>只能在组件内部进行setState</li>
<li>代表组件内部自身的状态，只能在自身组件中存在</li>
</ul>
<h4 id="props"><a href="#props" class="headerlink" title="props"></a>props</h4><p>组件中的props是一种父级向子级传递数据的方式，作用是让使用该组件的父组件可以传入参数来配置该组件。它是外部传进来的配置参数，组件内部无法控制也无法修改，除非外部传入的props发生改变</p>
<p><strong>尽量减少react组件的state，来降低组件的复杂性以及维护的难度</strong></p>
<h3 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h3><p>React 支持一种非常特殊的属性 Ref ，你可以用来绑定到 render() 输出的任何组件上</p>
<p>这个特殊的属性允许你引用 render() 返回的相应的支撑实例（ backing instance ）。这样就可以确保在任何时间总是拿到正确的实例</p>
<p>例如:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> MyComponent = React.createClass(&#123;</span><br><span class="line">  handleClick: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 使用原生的 DOM API 获取焦点</span></span><br><span class="line">    <span class="keyword">this</span>.refs.myInput.focus();</span><br><span class="line">  &#125;,</span><br><span class="line">  render: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//  当组件插入到 DOM 后，ref 属性添加一个组件的引用于到 this.refs</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;input type=<span class="string">"text"</span> ref=<span class="string">"myInput"</span> /&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          type=<span class="string">"button"</span></span><br><span class="line">          value=<span class="string">"点我输入框获取焦点"</span></span><br><span class="line">          onClick=&#123;<span class="keyword">this</span>.handleClick&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;);</span></span><br><span class="line"><span class="regexp"> </span></span><br><span class="line"><span class="regexp">ReactDOM.render(</span></span><br><span class="line"><span class="regexp">  &lt;MyComponent /</span>&gt;,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'example'</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h3><p>在某些场景下，你想在整个组件树中传递数据，但却不想手动地在每一层传递属性。你可以直接在 React 中使用<code>context</code> API解决上述问题</p>
<blockquote>
<p>绝大多数应用不需要使用<code>context</code>，这只是一个实验性的API，很有可能在未来的React版本中移除</p>
</blockquote>
<p>这里有个官方的<code>context</code><a href="https://reactjs.org/docs/context.html" target="_blank" rel="noopener">例子</a>，代码比较长我就不搬运了</p>
<h3 id="React事件"><a href="#React事件" class="headerlink" title="React事件"></a>React事件</h3><p>React有一套自己的事件系统，一般来说元素绑定事件都要用到<a href="https://reactjs.org/docs/handling-events.html" target="_blank" rel="noopener">React提供的事件接口</a></p>
<p>React的事件其实是做了一层事件代理(事件委托)，使用一个统一的事件监听器，当事件发生的时候，在映射里找到真正的处理函数并调用，简化了事件处理和回收机制，提升了效率。</p>
<blockquote>
<p>如果你打印一下这个事件，就会发现是一个Proxy对象</p>
</blockquote>
<p>如果在React中绑定了原生事件，组件卸载的时候记得解绑，避免内存泄漏</p>
<p><strong>所以尽量避免在React中使用混合事件和Dom事件</strong></p>
<h3 id="高阶组件-HOC"><a href="#高阶组件-HOC" class="headerlink" title="高阶组件(HOC)"></a>高阶组件(HOC)</h3><p>高阶组件（HOC）是React开发中的特有名词，一个函数返回一个React组件，指的就是一个React组包裹着另一个React组件。可以理解为一个生产React组件的工厂</p>
<blockquote>
<p>一句话概括：接受一个组件作为参数，返回一个组件的函数</p>
</blockquote>
<p>有两种类型的HOC:</p>
<ul>
<li>Props Proxy（pp） HOC对被包裹组件<code>WrappedComponent</code>的props进行操作</li>
<li>Inherbitance Inversion（ii）HOC继承被包裹组件<code>WrappedComponent</code></li>
</ul>
<p>例子:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Target 是一个组件，它作为参数传给了Hoc这个函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Hoc</span>(<span class="params">Target</span>) </span>&#123;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Wrap</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">          &lt;div className=<span class="string">'wrap'</span>&gt;</span><br><span class="line">            &lt;Target /&gt;</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  return Wrap;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>本文随时间更新</p>
</blockquote>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">AddOneG</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2018/03/28/深入React知识点/">http://yoursite.com/2018/03/28/深入React知识点/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/前端/">前端</a><a class="post-meta__tags" href="/tags/React/">React</a><a class="post-meta__tags" href="/tags/React-Native/">React-Native</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2018/04/03/一个前端开发者的自我折磨-UI/"><i class="fa fa-chevron-left">  </i><span>一个前端开发者的自我折磨(UI)</span></a></div><div class="next-post pull-right"><a href="/2018/03/28/Webpack配置讲解/"><span>Webpack配置讲解</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2018 By AddOneG</div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.5.3"></script><script src="/js/fancybox.js?version=1.5.3"></script><script src="/js/sidebar.js?version=1.5.3"></script><script src="/js/copy.js?version=1.5.3"></script><script src="/js/fireworks.js?version=1.5.3"></script><script src="/js/transition.js?version=1.5.3"></script><script src="/js/scroll.js?version=1.5.3"></script><script src="/js/head.js?version=1.5.3"></script></body></html>