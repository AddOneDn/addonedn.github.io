<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.2 -->
    <script>
        window.materialVersion = "1.5.2"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1',
            '1.5.0'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">














    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <link rel="manifest" href="/manifest.json">
    <!-- Title -->
    
    <title>
        
            React源码自阅读(长篇) | 
        
        AddOne
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.ico">
    <link rel="icon" href="/img/favicon.png">

    <meta name="format-detection" content="telephone=no"/>
    <meta name="description" itemprop="description" content="徐嘉一的博客">
    <meta name="keywords" content="null,React,源码">
    <meta name="theme-color" content="#0097A7">

    <!-- Disable Fucking Bloody Baidu Tranformation -->
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(a){try{localStorage.removeItem(a)}catch(b){}};lsloader.setLS=function(a,c){try{localStorage.setItem(a,c)}catch(b){}};lsloader.getLS=function(a){var c="";try{c=localStorage.getItem(a)}catch(b){c=""}return c};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var b=[];for(var a=0;a<localStorage.length;a++){b.push(localStorage.key(a))}b.forEach(function(e){var f=lsloader.getLS(e);if(window.oldVersion){var d=window.oldVersion.reduce(function(g,h){return g||f.indexOf("/*"+h+"*/")!==-1},false);if(d){lsloader.removeLS(e)}}})}catch(c){}};lsloader.clean();lsloader.load=function(f,a,b,d){if(typeof b==="boolean"){d=b;b=undefined}d=d||false;b=b||function(){};var e;e=this.getLS(f);if(e&&e.indexOf(versionString)===-1){this.removeLS(f);this.requestResource(f,a,b,d);return}if(e){var c=e.split(versionString)[0];if(c!=a){console.log("reload:"+a);this.removeLS(f);this.requestResource(f,a,b,d);return}e=e.split(versionString)[1];if(d){this.jsRunSequence.push({name:f,code:e});this.runjs(a,f,e)}else{document.getElementById(f).appendChild(document.createTextNode(e));b()}}else{this.requestResource(f,a,b,d)}};lsloader.requestResource=function(b,e,a,c){var d=this;if(c){this.iojs(e,b,function(h,f,g){d.setLS(f,h+versionString+g);d.runjs(h,f,g)})}else{this.iocss(e,b,function(f){document.getElementById(b).appendChild(document.createTextNode(f));d.setLS(b,e+versionString+f)},a)}};lsloader.iojs=function(d,b,g){var a=this;a.jsRunSequence.push({name:b,code:""});try{var f=new XMLHttpRequest();f.open("get",d,true);f.onreadystatechange=function(){if(f.readyState==4){if((f.status>=200&&f.status<300)||f.status==304){if(f.response!=""){g(d,b,f.response);return}}a.jsfallback(d,b)}};f.send(null)}catch(c){a.jsfallback(d,b)}};lsloader.iocss=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.iofonts=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.runjs=function(f,c,e){if(!!c&&!!e){for(var b in this.jsRunSequence){if(this.jsRunSequence[b].name==c){this.jsRunSequence[b].code=e}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var a=document.createElement("script");a.appendChild(document.createTextNode(this.jsRunSequence[0].code));a.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(a);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else{if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var d=this;var a=document.createElement("script");a.src=this.jsRunSequence[0].path;a.type="text/javascript";this.jsRunSequence[0].status="loading";a.onload=function(){d.jsRunSequence.shift();if(d.jsRunSequence.length>0){d.runjs()}};document.body.appendChild(a)}}};lsloader.tagLoad=function(b,a){this.jsRunSequence.push({name:a,code:"",path:b,status:"failed"});this.runjs()};lsloader.jsfallback=function(c,b){if(!!this.jsnamemap[b]){return}else{this.jsnamemap[b]=b}for(var a in this.jsRunSequence){if(this.jsRunSequence[a].name==b){this.jsRunSequence[a].code="";this.jsRunSequence[a].status="failed";this.jsRunSequence[a].path=c}}this.runjs()};lsloader.cssfallback=function(e,c,b){if(!!this.cssnamemap[c]){return}else{this.cssnamemap[c]=1}var d=document.createElement("link");d.type="text/css";d.href=e;d.rel="stylesheet";d.onload=d.onerror=b;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(d,a)};lsloader.runInlineScript=function(c,b){var a=document.getElementById(b).innerText;this.jsRunSequence.push({name:c,code:a});this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/css/material.min.css?Z7a72R1E4SxzBKR/WGctOA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/css/style.min.css?MKetZV3cUTfDxvMffaOezg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        
            
                <style id="prettify_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_css","/css/prettify.min.css?zp8STOU9v89XWFEnN+6YmQ==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
                <style id="prettify_theme"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_theme","/css/prettify/tomorrow-night-eighties.min.css?2LJQzURO+Kr8r/fl/T8oMA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
            
        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #2578b5;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #303030 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #303030 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #303030 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #2578b5;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-image: url(/img/bg.jpeg);
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">


<!-- Import Material Icons -->


    <style id="material_icons"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_icons","/css/material-icons.css?pqhB/Rd/ab0H2+kZp0RDmw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","/js/jquery.min.js?qcusAULNeBksqffqUM2+Ig==", true)</script>
    

    <!-- WebAPP Icons -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="AddOne">
    <meta name="msapplication-starturl" content="http://yoursite.com/2018/04/18/React源码阅读-1白话/">
    <meta name="msapplication-navbutton-color" content="#0097A7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="AddOne">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://yoursite.com/2018/04/18/React源码阅读-1白话/">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="React源码自阅读(长篇) | AddOne">
    <meta property="og:image" content="/img/favicon.png">
    <meta property="og:description" content="徐嘉一的博客">
    <meta property="og:article:tag" content="React"> <meta property="og:article:tag" content="源码"> 

    
        <meta property="article:published_time" content="Wed Apr 18 2018 22:33:29 GMT+0800">
        <meta property="article:modified_time" content="Sun Apr 22 2018 13:45:02 GMT+0800">
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:card" content="summary_large_image">

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://yoursite.com/2018/04/18/React源码阅读-1白话/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "http://yoursite.com/2018/04/18/React源码阅读-1白话/index.html",
    "headline": "React源码自阅读(长篇)",
    "datePublished": "Wed Apr 18 2018 22:33:29 GMT+0800",
    "dateModified": "Sun Apr 22 2018 13:45:02 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "AddOneG",
        "image": {
            "@type": "ImageObject",
            "url": "/img/avatar.png"
        },
        "description": "Talk is cheap, Show me the code"
    },
    "publisher": {
        "@type": "Organization",
        "name": "AddOne",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/favicon.png"
        }
    },
    "keywords": ",React,源码null",
    "description": "徐嘉一的博客",
}
</script>


    

    <!-- Analytics -->
    
    
    

    <!-- Custom Head -->
    

</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#背景"><span class="post-toc-number">1.</span> <span class="post-toc-text">背景</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#开始"><span class="post-toc-number">2.</span> <span class="post-toc-text">开始</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#组件"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">组件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#事务"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">事务</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Transaction"><span class="post-toc-number">2.2.1.</span> <span class="post-toc-text">Transaction</span></a></li></ol></li></ol></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 9 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                React源码自阅读(长篇)
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>AddOneG</strong>
        <span>4月 18, 2018</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/React/">React</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/源码/">源码</a>
    </ul>
    

    <!-- Share -->
    
        <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=React源码自阅读(长篇)&url=http://yoursite.com/2018/04/18/React源码阅读-1白话/index.html&via=AddOneG" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    

    <!-- Share Google+ -->
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    
        <a class="post_share-link" href="http://connect.qq.com/widget/shareqq/index.html?site=AddOne&title=React源码自阅读(长篇)&summary=徐嘉一的博客&pics=http://yoursite.com/img/favicon.ico&url=http://yoursite.com/2018/04/18/React源码阅读-1白话/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 QQ
            </li>
        </a>
    

    <!-- Share Telegram -->
    
</ul>

    
</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>准备有时间写一个类<code>react</code>的框架，所以先读一下<code>react</code>的源码</p>
<h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><p>这里先自己用parcel简单搭建了一个React环境又随便写了点组件</p>
<h3 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h3><pre><code class="Javascript">import React, { Component } from &#39;react&#39;;

import MyNav from &#39;../components/MyNav&#39;

class MainContainer extends Component {

  componentDidMount(){
    console.log(&lt;MyNav&gt;&lt;/MyNav&gt;)
  }

  render() {
    return (
      &lt;div&gt;
        &lt;MyNav&gt;&lt;/MyNav&gt;
      &lt;/div&gt;
    );
  }
}

export default MainContainer;
</code></pre>
<p>这里随便写了一个<code>Js</code>, 然后打印了一下<code>MyNav</code>组件</p>
<p><img src="http://p5sf6v0wz.bkt.clouddn.com/react1-1.png" alt="react1-1"></p>
<p>很明显这是一个<code>Js</code>对象而不是<code>Dom</code></p>
<p>如果在里面嵌套一个子元素…</p>
<p><code>console.log(&lt;MyNav&gt;&lt;div&gt;Hello&lt;/div&gt;&lt;/MyNav&gt;)</code></p>
<p><img src="http://p5sf6v0wz.bkt.clouddn.com/react1-2.png" alt="react1-2"></p>
<p>我们会发现在<code>props</code>里多了一个<code>children</code>成员，同样也是一个<code>JS</code>对象</p>
<p>如果再多嵌套一下的话(这里写的好看点)</p>
<pre><code class="Javascript">console.log(
  &lt;MyNav&gt;
    &lt;div&gt;
      Hello
      &lt;span&gt;React&lt;/span&gt;
    &lt;/div&gt;
  &lt;/MyNav&gt;
)
</code></pre>
<p><img src="http://p5sf6v0wz.bkt.clouddn.com/react1-3.png" alt="react1-3"></p>
<p>可以看到这里会在<code>props</code>里面无限的套下去，同时如果一个元素内嵌了多个子元素的话，这些子元素在<code>props</code>的<code>children</code>里会以数组的方式存在</p>
<blockquote>
<p>在这里不禁唱起：套马滴汉子你威武雄壮~</p>
</blockquote>
<p>那我们不如就顺着这个问题深入，先看一下<code>React.js</code> </p>
<pre><code class="Javascript">const React = {
  ...... //省略

  Component,
  createElement: __DEV__ ? createElementWithValidation : createElement,

  ...... //省略
}
</code></pre>
<p>我们先看一下<code>Component</code></p>
<pre><code class="Javascript">/* 
  node_modules/react/cjs/react.development.js
*/

function Component(props, context, updater) {
  this.props = props;
  this.context = context;
  this.refs = emptyObject;
  // We initialize the default updater but the real one gets injected by the
  // renderer.
  this.updater = updater || ReactNoopUpdateQueue;
}
</code></pre>
<blockquote>
<p>组件<code>extends</code>的<code>Components</code>就是继承的这玩意</p>
</blockquote>
<p>这里没什么好说的，一个构造函数，重点是看看那个<code>children</code>到底是怎么个回事</p>
<p>然后看一哈<code>createElement</code></p>
<pre><code class="Javascript">/* 
  node_modules/react/cjs/react.development.js
*/

function createElement(type, config, children) {
  var propName;

  // Reserved names are extracted
  var props = {};

  var key = null;
  var ref = null;
  var self = null;
  var source = null;

  ..... // 省略

  // Children can be more than one argument, and those are transferred onto
  // the newly allocated props object.
  var childrenLength = arguments.length - 2;
  if (childrenLength === 1) {
    props.children = children;
  } else if (childrenLength &gt; 1) {
    var childArray = Array(childrenLength);
    for (var i = 0; i &lt; childrenLength; i++) {
      childArray[i] = arguments[i + 2];
    }
    {
      if (Object.freeze) {
        Object.freeze(childArray);
      }
    }
    props.children = childArray;
  }

  ...... //省略

  return ReactElement(type, key, ref, self, source, ReactCurrentOwner.current, props);
}
</code></pre>
<p>东西都在这里，代码也很容易理解，这里初始化了一堆东西（你可以很清晰的看到<code>children</code>的处理方式)，最后用<code>ReactElement</code>这个工厂函数返回一个<code>React</code>元素</p>
<blockquote>
<p><code>Object.freeze</code>这里就不讲了 有兴趣的去百度一哈</p>
</blockquote>
<p>那么问题来了..<code>Component</code>是继承来的，那这个<code>createElement</code>是什么时候执行的呢?</p>
<p>常规思路是在<code>render</code>里, 那就去看一下</p>
<pre><code class="Javascript">var ReactMount = {

  /**入口render方法
   * @param {ReactElement} nextElement 要插入到DOM中的组件
   * @param {DOMElement} container 要插入到的容器
   * @param {?function} callback 回调
   * @return {ReactComponent} Component instance rendered in `container`.返回ReactComponent
   */
  render: function (nextElement, container, callback) {
    return ReactMount._renderSubtreeIntoContainer(
      null,
      nextElement,
      container,
      callback,
    );
  },

  ......
  /**
   * 将ReactElement插入DOM中，并返回ReactElement对应的ReactComponent。
   * ReactElement是React元素在内存中的表示形式，可以理解为一个数据类，包含type，key，refs，props等成员变量
   * ReactComponent是React元素的操作类，包含mountComponent(), updateComponent()等很多操作组件的方法
   */
   /* 
    parentComponent: 当前组件的父组件
    nextElement: 要插入的组件
    container: 要插入的容器
    callback: 回调函数
   */
  _renderSubtreeIntoContainer: function (
    parentComponent,
    nextElement,
    container,
    callback,
  ) {
    callback = callback === undefined ? null : callback;

    var nextWrappedElement = React.createElement(TopLevelWrapper, {
      child: nextElement,
    });
  }

  ......
}
</code></pre>
<p>在<code>render</code>里可以看到用<code>React</code>的成员方法<code>createElement</code>创建了一个元素返回给了<code>nextWrappedElement</code></p>
<p>我们跟踪一下<code>nextWrappedElement</code></p>
<pre><code class="Javascript">// 获取要插入到的容器的前一次的ReactComponent，这是为了做DOM diff
var prevComponent = getTopLevelWrapperInContainer(container);

if (prevComponent) {
  var prevWrappedElement = prevComponent._currentElement;
  var prevElement = prevWrappedElement.props.child;

  // shouldUpdateReactComponent方法判断是否需要更新,它只对同一DOM层级，type相同，key(如果有)相同的组件做DOM diff，
  if (shouldUpdateReactComponent(prevElement, nextElement)) {
    var publicInst = prevComponent._renderedComponent.getPublicInstance();
    var updatedCallback =
      callback &amp;&amp;
      function () {
        validateCallback(callback);
        callback.call(publicInst);
      };
    ReactMount._updateRootComponent(
      prevComponent,
      nextWrappedElement,
      nextContext,
      container,
      updatedCallback,
    );
    return publicInst;
  } else {
    //直接unmount
    ReactMount.unmountComponentAtNode(container);
  }
  // 对于ReactDOM.render()调用，prevComponent为null
  var reactRootElement = getReactRootElementInContainer(container);
  var containerHasReactMarkup =
    reactRootElement &amp;&amp; !!internalGetID(reactRootElement);
  var containerHasNonRootReactChild = hasNonRootReactChild(container);

  var shouldReuseMarkup =
    containerHasReactMarkup &amp;&amp;
    !prevComponent &amp;&amp;
    !containerHasNonRootReactChild;

  var component = ReactMount._renderNewRootComponent(
    nextWrappedElement,
    container,
    shouldReuseMarkup,
    nextContext,
    callback,
  )._renderedComponent.getPublicInstance();
  return component;
}
</code></pre>
<p>简单梳理一下这个函数: 先拿到前一次的<code>ReactComponent</code>做<code>dom diff</code>，然后<code>shouldUpdateReactComponent</code>判断一下是否需要更新，如果需要的话就<code>diff</code>之后<code>_updateRootComponent</code>，否则直接卸载；然后调用<code>_renderNewRootComponent</code>渲染新的组件，这两个函数都有上文提到的<code>nextWrappedElement</code>作为参数</p>
<blockquote>
<p>到这里问题差不多就解决啦，不过我决定弄个图来直观的表现一哈</p>
</blockquote>
<p><img src="http://p5sf6v0wz.bkt.clouddn.com/react-component.png" alt="react-component"></p>
<p>至于<code>instantiateReactComponent</code>创建的四种组件感觉没什么深入的必要，这里就不讨论了</p>
<h3 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h3><p>上面组件那一节讨论的<code>Component</code>下面还有几行代码</p>
<pre><code class="Javascript">Component.prototype.setState = function(partialState, callback) {
    this.updater.enqueueSetState(this, partialState);
    if (callback) {
      this.updater.enqueueCallback(this, callback, &#39;setState&#39;);
    } 
};
</code></pre>
<p>这里传入两个参数，分别为新的<code>state</code>和回调函数，这里的<code>updater</code>是在<code>Component</code>中定义的<code>this.updater = updater || ReactNoopUpdateQueue</code></p>
<p>这里我们看一下<code>enqueueSetState</code>是啥</p>
<pre><code class="Javascript">enqueueSetState: function(publicInstance, partialState){ 
  var internalInstance = getInternalInstanceReadyForUpdate(
    publicInstance,
    &#39;setState&#39; 
  );

  if (!internalInstance) { 
    return;
  }

  // 更新队列合并操作
  var queue = internalInstance._pendingStateQueue || (internalInstance._pendingStateQueue = []);

  queue.push(partialState);
  enqueueUpdate(internalInstance); 
}
</code></pre>
<p><code>getInternalInstanceReadyForUpdate</code>获取了当前组件并赋给了<code>internalInstance</code>，然后判断<code>internalInstance</code>的<code>_pendingStateQueue</code>(state更新队列)是否为空，若为空则初始化为数组，然后将<code>partialState</code>即新的<code>state</code>推入，然后调用<code>enqueueUpdate</code></p>
<pre><code class="Javascript">function enqueueUpdate(component) {

  if (!batchingStrategy.isBatchingUpdates) {
    batchingStrategy.batchedUpdates(enqueueUpdate, component);
    return; 
  }

  dirtyComponents.push(component); 
}
</code></pre>
<p>当<code>batchingStrategy.isBatchingUpdates</code>为<code>false</code>，即不处于更新状态的时候，调用<code>batchedUpdates</code>对组件进行更新，否则将组件推入<code>dirtyComponents</code>中</p>
<p>但是让我们先看一下<code>batchingStrategy</code>是个啥..</p>
<pre><code class="Javascript">var ReactDefaultBatchingStrategy = { 
  isBatchingUpdates: false,

  batchedUpdates: function(callback, a, b, c, d, e) {
    var alreadyBatchingUpdates = ReactDefaultBatchingStrategy.isBatchingUpdates;
    ReactDefaultBatchingStrategy.isBatchingUpdates = true;

    if (alreadyBatchingUpdates) { 
        callback(a, b, c, d, e);
    } else {
        transaction.perform(callback, null, a, b, c, d, e);
    } 
  },
}
</code></pre>
<p>这里初始状态为<code>false</code>，在<code>batchedUpdates</code>中拿到此时<code>ReactDefaultBatchingStrategy</code>的<code>isBatchingUpdates</code>赋给<code>alreadyBatchingUpdates</code>，然后将其设置为<code>true</code>;如果<code>alreadyBatchingUpdates</code>为<code>true</code>则直接执行回调函数，否则进行<code>transaction.perform</code></p>
<h4 id="Transaction"><a href="#Transaction" class="headerlink" title="Transaction"></a>Transaction</h4><p>上面都是铺垫，这里就进入真正的事务里了~ 先放一张官方源码的解析图</p>
<p><img src="http://p5sf6v0wz.bkt.clouddn.com/react-transaction.png" alt="react-transaction"></p>
<p>事务就是把方法用<code>wrapper</code>封装起来，再通过事务的<code>perform</code>方法进行调用，从图里可以看出在执行被包裹的方法前后分别执行<code>initialize</code>和<code>close</code>，一组<code>initialize</code>和<code>close</code>方法称为一个<code>wrapper</code>，事务支持多个<code>wrapper</code>叠加</p>
<p>上文的<code>perform(callback)</code>即<code>perform(enqueueUpdate)</code>，这里再放一张网上随便偷来的流程图帮助理解</p>
<p><img src="http://p5sf6v0wz.bkt.clouddn.com/react-setState-preform.png" alt=""></p>
<p>我们看一下上文的两个<code>wrapper</code></p>
<pre><code class="Javascript">var RESET_BATCHED_UPDATES = {
  initialize: emptyFunction,
  close: function(){
    ReactDefaultBatchingStrategy.isBatchingUpdates = false
  }
}

var FLUSH_BATCHED_UPDATES = {
  initialize: emptyFunction,
  close: function(){
    ReactUpdates.flushBatchedUpdates.bind(ReactUpdates)
  }
}
</code></pre>
<p><code>RESET_BATCHED_UPDATES</code>即是一个<code>wrapper</code>，从图可以看出它应该是用来修改<code>isBatchingUpdates</code>的值，需要更新的时候设置为更新，更新结束后恢复状态，这样不仅可以节省渲染，还能防止<code>enqueueUpdate</code>的递归调用导致死循环</p>
<blockquote>
<p>那么在<code>dirtyComponents</code>中是如何进行组件更新的呢?</p>
</blockquote>
<p>这里涉及到另一个<code>wrapper</code>即<code>FLUSH_BATCHED_UPDATES</code>，我们看一下<code>flushBatchedUpdates</code></p>
<pre><code class="Javascript">var flushBatchedUpdates = function() {
  while(dirtyComponents.length || asapEnqueued){
    if(dirtyComponents.length){
      var transaction = ReactUpdatesFlushTransaction.getPooled()
      transaction.perform(runBatchedUpdates,null,transaction)
      ReactUpdatesFlushTransaction.release(transaction)
    }
    ......
  }
}
</code></pre>
<p><code>flushBatchedUpdates</code>遍历了<code>dirtyComponents</code>，然后用事务执行<code>runBatchedUpdates</code>方法</p>
<p>搜了一下，这个函数主要执行以下两步</p>
<ul>
<li>一是通过执行<code>updateComponent</code>方法来更新组件</li>
<li>二是若<code>setState</code>方法传入了回调函数则将回调函数存入<code>callbackQueue</code>队列</li>
</ul>
<p>先看一下<code>updateComponent</code>源码</p>
<p><img src="http://p5sf6v0wz.bkt.clouddn.com/react-updateComponent.png" alt=""></p>
<p>能看到两个比较重要的函数名<code>componentWillReceiveProps</code>和<code>shouldComponentUpdate</code>，但是根据<code>nextState</code>让我们先看一下<code>_processPendingState</code>这个函数</p>
<p><img src="http://p5sf6v0wz.bkt.clouddn.com/processPendingState.png" alt=""></p>
<p>理解一下:</p>
<ul>
<li>更新队列为<code>null</code>则直接返回原来<code>state</code></li>
<li>若队列不为<code>null</code>则返回(大于<code>1</code>则合并)</li>
</ul>
<p>在<code>updateComponent</code>中，如果<code>shouldUpdate</code>为<code>true</code>,则执行<code>_performComponentUpdate</code></p>
<p><img src="http://p5sf6v0wz.bkt.clouddn.com/performComponentUpdate.png" alt=""></p>
<p>这里能看到<code>componentWillUpdate</code>这个生命周期函数，没什么深入的必要，我们看看上文中最后的更新函数<code>_updateRenderedComponent</code></p>
<p><img src="http://p5sf6v0wz.bkt.clouddn.com/updateRenderedComponent.png" alt=""></p>
<p>拿到新旧组件信息后传给<code>shouldUpdateReactComponent</code>，根据返回值<code>true or false</code>决定是更新旧组件还是卸载旧组件挂载新组件</p>
<p><img src="http://p5sf6v0wz.bkt.clouddn.com/reactSetState.png" alt=""></p>

        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
    <!-- 使用 gitcoment -->
<div id="gitment-comment">
    <!-- Gitment 评论框 -->
<div id="container"></div>
</div>
<style>
    #gitment-comment{
        background-color: #eee;
        padding: 2pc;
    }
    .gitment-comment-header{
        background-color: #eee !important;
    }
    .gitment-editor-main::after, .gitment-comment-main::after{
        border-right-color: #eee !important;
    }
    .gitment-container .gitment-footer-container{
        display: none;
    }
</style>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
    var gitment = new Gitment({
        id: 'Wed Apr 18 2018 22:33:29 GMT+0800', // 可选。默认为 location.href
        owner: 'addonedn',
        repo: 'addonedn.github.io',
        oauth: {
            client_id: 'fd718a86061e47c1b4da',
            client_secret: '2c8a8ca488298cb76ca81f3baac2b886383defde',
        },
    })
    gitment.render('container')
</script>

                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2018/04/22/自写一个react-like项目/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2018/04/16/MVC-MVVM-MVP/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar.jpeg);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="AddOneG's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        我的链接
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="https://juejin.im/user/5800c5b267f3560058a9f89f" target="_blank" title="XiTu">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">favorite</i>
                        
                        XiTu
                    </a>
                </li>
            
                <li>
                    <a href="https://github.com/AddOneDn" target="_blank" title="GitHub">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">star</i>
                        
                        GitHub
                    </a>
                </li>
            
                <li>
                    <a href="https://coding.net/u/addone" target="_blank" title="Coding">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">sentiment_satisfied</i>
                        
                        Coding
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2018/04/">四月 2018<span class="sidebar_archives-count">9</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/03/">三月 2018<span class="sidebar_archives-count">17</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/01/">一月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/04/">四月 2017<span class="sidebar_archives-count">6</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/Bug/">Bug<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/关于我/">关于我<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/前端/">前端<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/吐槽/">吐槽<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/我爱的人/">我爱的人<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/技术/">技术<span class="sidebar_archives-count">24</span></a></li><li><a class="sidebar_archives-link" href="/categories/技术/面试/">面试<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/links" title="友情链接">
                
                    <i class="material-icons sidebar-material-icons">airplanemode_active</i>
                
                友情链接
            </a>
        </li>
        
    
        <li>
            <a href="/timeline" title="时间轴">
                
                    <i class="material-icons sidebar-material-icons">directions_run</i>
                
                时间轴
            </a>
        </li>
        
    
        <li>
            <a href="/about" title="关于我">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                关于我
            </a>
        </li>
        
    
        <li>
            <a href="/gallery" title="十八禁">
                
                    <i class="material-icons sidebar-material-icons">mood_bad</i>
                
                十八禁
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                文章总数
                <span class="sidebar-badge">33</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->


<!-- Theme Material -->


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/6ciwTfTtUFutSj2" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-twitter">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    

    <!-- Google + -->
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/AddOneDn" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-github">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
    
    <!-- V2EX -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©<script type="text/javascript">var fd = new Date();document.write("&nbsp;" + fd.getFullYear() + "&nbsp;");</script>AddOne
            
        </div>


        <div class="mdl-mini-footer--right-section">
            
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/js/lazyload.min.js?1BcfzuNXqV+ntF6gq+5X3Q==", true)</script>



    <script>lsloader.load("js_js","/js/js.min.js?V/53wGualMuiPM3xoetD5Q==", true)</script>



    <script>lsloader.load("np_js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>









   <!-- Gitment -->





<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->

    
        
            <script>lsloader.load("prettify_js","/js/prettify.min.js?WN07fivHQSMKWy7BmHBB6w==", true)</script>
        
    



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
        
            $(function() {
                $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
                prettyPrint();
                })
        
    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
</script>

                </main>
            </div>
        </body>
    
</html>
